syntax = "proto3";

package rootlayer.v1;

option go_package = "github.com/PIN-AI/pin-protocol-proto/rootlayer/proto;rootlayerv1";

import "intent.proto";

// ====================================================================================
// Direct Mode Message Definitions
// ====================================================================================

// AgentConnectRequest - Agent initiates connection
message AgentConnectRequest {
  string agent_address = 1;
  bytes signature = 2;        // Signature proving Agent identity
  string client_version = 3;  // Agent client version
  int64 timestamp = 4;        // Connection timestamp (unix seconds, for signature freshness)
  bytes random_nonce = 5;     // 32-byte random nonce (for signature uniqueness)
  // ERC-8004 agent id (tokenId) this connection represents.
  string agent_id = 6;
}

// DirectIntentPush - Relayer pushes Intent to Agent via stream
message DirectIntentPush {
  string intent_id = 1;
  string subnet_id = 2;
  string requester = 3;
  string intent_type = 4;
  IntentParams params = 5;
  string payment_token = 6;
  string amount = 7;
  int64 deadline = 8;
  int64 challenge_end_timestamp = 9;
  bytes params_hash = 10;
  string target_agent_id = 11;
}

// HeartbeatRequest - Agent sends heartbeat
message HeartbeatRequest {
  string agent_address = 1;
  int64 timestamp = 2;
  // ERC-8004 agent id (tokenId) this heartbeat belongs to.
  string agent_id = 3;
}

// DirectResultRequest - Agent submits execution result
message DirectResultRequest {
  string intent_id = 1;
  string agent_address = 2;
  bool success = 3;
  bytes result_data = 4;
  string error_message = 5;
  int64 timestamp = 6;
  bytes agent_signature = 7;  // Agent's signature over the result
  string target_agent_id = 8;
  string subnet_id = 9;
}

// DirectResultResponse - Response to Agent result submission
message DirectResultResponse {
  bool ok = 1;
  string msg = 2;
  string result_hash = 3;  // keccak256(result_data) for verification
}

// SubmitDirectIntentRequest - User submits Direct Intent (aligned with SubmitIntentRequest)
message SubmitDirectIntentRequest {
  // Client-provided intent ID. A 32-byte 0x-prefixed hex value is recommended.
  string intent_id = 1;
  // Target subnet identifier (32-byte 0x-prefixed hex string).
  string subnet_id = 2;
  // Requester wallet address (EIP-55 checksum expected).
  string requester = 3;
  // Settlement chain name, e.g. "base_sepolia".
  string settle_chain = 4;
  // Application-specific intent type, e.g. "book_flight".
  string intent_type = 5;
  // Execution parameters. The on-chain params hash is keccak256(params).
  IntentParams params = 6;
  // ERC-20 token address for payment (0x0 for native).
  string payment_token = 7;
  // Payment amount as uint256 decimal string.
  string amount = 8;
  // Execution deadline (unix seconds).
  int64 deadline = 9;
  // User signature covering canonical intent content (EIP-191).
  bytes signature = 10;
  // Target agent address for Direct Mode execution.
  string target_agent = 11;
  // ERC-8004 agent id (tokenId) for routing.
  string target_agent_id = 12;
}

// SubmitDirectIntentResponse - Response to user submission (sync mode only)
message SubmitDirectIntentResponse {
  bool ok = 1;
  string msg = 2;
  string intent_id = 3;

  // Agent execution result (returned within 30s timeout)
  DirectResult result = 4;

  // keccak256(params) used by on-chain verification
  bytes params_hash = 5;

  // Current intent status
  string status = 6;
}

// DirectResult - Agent execution result (embedded in response)
message DirectResult {
  string intent_id = 1;
  string agent_address = 2;
  bool success = 3;
  bytes result_data = 4;
  string result_hash = 5;
  string error_message = 6;
  int64 timestamp = 7;
  string target_agent_id = 8;
  string subnet_id = 9;
}

// GetDirectResultRequest - User queries result
message GetDirectResultRequest {
  string intent_id = 1;
}

// DirectResultDetail - Full result details including metadata
message DirectResultDetail {
  string intent_id = 1;
  string agent_address = 2;
  bool success = 3;
  bytes result_data = 4;
  string result_hash = 5;
  string error_message = 6;
  int64 timestamp = 7;
  bool result_received = 8;
  int64 received_at = 9;
  int64 challenge_end_timestamp = 10;
  bool disputed = 11;
  string current_status = 12;
  string target_agent_id = 13;
  string subnet_id = 14;
}
