syntax = "proto3";
package rootlayer.v1;

option go_package = "github.com/PIN-AI/pin-protocol-proto/rootlayer/proto;rootlayerv1";

// Assignment status simplified to two primary states used by RootLayer.
enum AssignmentStatus {
  // Unspecified (default/invalid)
  ASSIGNMENT_STATUS_UNSPECIFIED = 0;
  // Active (agent accepted and executing)
  ASSIGNMENT_ACTIVE = 1;
  // Failed (expired, rejected, or execution failed)
  ASSIGNMENT_FAILED = 2;
}

// Assignment selected by a subnet matcher for a given intent.
message Assignment {
  // Assignment ID (UUID recommended).
  string assignment_id = 1;
  // The associated intent ID.
  string intent_id = 2;
  // Selected agent identifier.
  string agent_id = 3;
  // The bid ID associated with this assignment.
  string bid_id = 4;
  // Current assignment status.
  AssignmentStatus status = 5;
  // Matcher ID (required for traceability and auditing).
  string matcher_id = 6;
  // Matcher signature authorizing the assignment.
  bytes signature = 7;
}

// Acknowledgment from an agent regarding an assignment.
message AssignmentAck {
  // Assignment ID being acknowledged.
  string assignment_id = 1;
  // Agent ID acknowledging the assignment.
  string agent_id = 2;
  // Acknowledgment timestamp (unix seconds).
  int64 acked_at = 3;
  // Whether the agent accepts the assignment.
  bool accepted = 4;
  // If not accepted, the reason provided by the agent.
  string rejection_reason = 5;
}

// Batch container for multiple assignments.
message AssignmentBatch {
  // Items in the batch.
  repeated Assignment assignments = 1;
  // Client-side batch ID for idempotency.
  string batch_id = 2;
  // Creation time for the batch (unix seconds).
  int64 created_at = 3;
}

// Query assignments for a particular agent.
message AgentAssignmentQuery {
  // Agent identifier to filter on.
  string agent_id = 1;
  // Optional status filter.
  AssignmentStatus status_filter = 2;
  // Pagination cursor.
  string cursor = 3;
  // Max number of items to return.
  uint32 limit = 4;
}
